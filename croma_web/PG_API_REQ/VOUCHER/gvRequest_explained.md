# What is `gvRequest` (why it looks like gibberish)

## TL;DR
`gvRequest` is **not plaintext JSON**.
It’s a **base64 string that represents AES-encrypted JSON** generated by the Croma frontend (CryptoJS).
So in your captures it will look like random characters.

That’s also why the raw API response can show:

- `gvDetails: null`
- but still returns a new `gvRequest`

Because the “real” voucher/gift-card details are **inside the encrypted blob**, and the browser decrypts it client-side.

## Where it happens (frontend proof)
In the downloaded checkout JS bundle the flow is:

- Build a JSON object (voucher / gift card details)
- Encrypt it using CryptoJS AES with the app’s configured secret key
- Send the ciphertext as `{ "gvRequest": "..." }`

On response:

- Take `data.gvRequest`
- Convert URL-safe base64 back to normal base64
- AES-decrypt
- `JSON.parse(...)`

Files that contain this logic in this workspace:

- [croma_web/xtra/Croma Payment Page_files/28.227385d7.chunk.js.download](croma_web/xtra/Croma%20Payment%20Page_files/28.227385d7.chunk.js.download)
- The key constant is present in: [croma_web/xtra/Croma Payment Page_files/main.12f68983.chunk.js.download](croma_web/xtra/Croma%20Payment%20Page_files/main.12f68983.chunk.js.download)

## What’s inside (before encryption)
For voucher/gift-card operations, the plaintext object looks like this shape:

```json
{
  "gvDetails": [
    {
      "cardNo": "<voucher-code-or-card-number>",
      "cardPin": "<pin-if-any>",
      "cardBal": <number>,
      "cardType": "<type>"
    }
  ],
  "gvType": "<provider/type>" 
}
```

After encrypting, that entire JSON becomes the single string `gvRequest`.

## Why the response has `_` and `-`
Your response `gvRequest` often contains `_` and `-`.
That’s **URL-safe base64**, where:

- `+` is replaced by `-`
- `/` is replaced by `_`
- padding `=` is often omitted

The frontend normalizes it back before decrypting:

- `- -> +`
- `_ -> /`

Note: AES_ENCRYPTION_SECRET_KEY_GV: L6256HH2N93K53J4   [128-bit key, encryption mode ecb]

So this difference is **encoding**, not “different encryption”.

## Crypto notes (what we can safely say)
- The implementation uses **CryptoJS AES**.
- The secret key is stored client-side as `AES_ENCRYPTION_SECRET_KEY_GV` (in the main bundle).
- The exact AES mode is set in the bundle via an imported `mode` object (you’ll see calls like `{mode: ge.a}` in the minified code). The important part for understanding the payload is: **it’s AES-encrypted, then base64 encoded**.

CryptoJS is present in this workspace as:

- [croma_web/pg_page/Croma Payment Page_files/aes.js.download](croma_web/pg_page/Croma%20Payment%20Page_files/aes.js.download)

## Practical “make it readable” checklist (authorized debugging)
If you want to verify that a captured `gvRequest` really contains your voucher code:

1. Take the response `gvRequest` string.
2. Replace `-` with `+` and `_` with `/`.
3. Decrypt it in the same environment/key/mode the site uses.
4. Parse the decrypted text as JSON.

Only do this for **your own traffic / authorized testing**.

## Why your capture shows `gvDetails: null`
The backend doesn’t always return expanded details as normal JSON fields.
Instead it returns `gvRequest` and expects the browser to decrypt it and then populate UI state.
So packet captures can look “empty” even though the data is present (encrypted).
